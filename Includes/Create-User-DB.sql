{"version":"NotebookV1","origId":17383880,"name":"Create-User-DB","language":"sql","commands":[{"version":"CommandV1","origId":17383881,"guid":"c873cecd-f8a9-4a98-8c21-6cae88998787","subtype":"command","commandType":"auto","position":1.0,"command":"\n%scala\nval dbNamePrefix = {\n  val tags = com.databricks.logging.AttributionContext.current.tags\n  val name = tags.getOrElse(com.databricks.logging.BaseTagDefinitions.TAG_USER, java.util.UUID.randomUUID.toString.replace(\"-\", \"\"))\n  val username = if (name != \"unknown\") name else dbutils.widgets.get(\"databricksUsername\")\n  \n  val module_name = spark.conf.get(\"com.databricks.training.module_name\", \"default\").toLowerCase()\n\n  val dbNamePrefix = (username+\"_\"+module_name).replaceAll(\"[^a-zA-Z0-9]\", \"_\") + \"_db\"\n  spark.conf.set(\"com.databricks.training.spark.dbNamePrefix\", dbNamePrefix)\n  dbNamePrefix\n}\n\ndisplayHTML(s\"Created user-specific database\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"100006","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"57d31ba9-70f9-42f8-b869-af04f528a189"},{"version":"CommandV1","origId":17383882,"guid":"ca550d9b-ec6b-4f90-9d3f-6796f4e088b0","subtype":"command","commandType":"auto","position":2.0,"command":"%python\n\ndbNamePrefix = spark.conf.get(\"com.databricks.training.spark.dbNamePrefix\")\ndatabaseName = dbNamePrefix + \"_ilq\"\nspark.conf.set(\"com.databricks.training.spark.databaseName\", databaseName)\n\nspark.sql(\"CREATE DATABASE IF NOT EXISTS {}\".format(databaseName))\nspark.sql(\"USE {}\".format(databaseName))\n\ndisplayHTML(\"\"\"Using the database <b style=\"color:green\">{}</b>.\"\"\".format(databaseName))\n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"100006","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e77327b0-5b05-46c2-99a8-a1c8f4d916f7"}],"dashboards":[],"guid":"947e400b-ce3f-4f51-8113-bfee142af3a5","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}